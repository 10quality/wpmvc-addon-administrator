if("undefined"==typeof jQuery)throw new Error("Wordpress Media Gallery requires jQuery");!function($){"use strict";$.fn.mediaUploader=function(options){var self=this;return self.settings=$.extend({editor:void 0,render:!0,clearTemplate:!0,clearTarget:!0,target:void 0,success:void 0,template:void 0,filterMedia:void 0},options),self._getTemplate=function(){void 0==self.settings.template&&(self.settings.template=$(self).html(),self.settings.clearTemplate&&$(self).html(""))},self._render=function(media){self.settings.render&&void 0!=self.settings.target&&$(self.settings.target).length>0&&(self.settings.clearTarget&&$(self.settings.target).html(""),$.each(media,function(i){$(self.settings.target).append(self._parseMedia(this))}))},self._parseMedia=function(media){if(void 0==self.settings.template)return"";var html=self.settings.template;return $.each(media,function(key){html=html.replace(new RegExp("{{"+key+"}}","g"),media[key],html),html=html.replace(new RegExp("{{ "+key+" }}","g"),media[key],html)}),html=$(html),"file"==media.type&&$(html).find("img").length>0&&$(html).find("img").remove(),"image"==media.type&&$(html).find("img").length>0&&$(html).find("img").attr("src",media.url),"embed"==media.type&&$(html).find("img").length>0&&$(html).find("img").attr("src",media.img),"video"==media.type&&media.img&&$(html).find("img").length>0&&$(html).find("img").attr("src",media.img),html},self._parseEditorHTML=function(html){var media=[];-1!==html.search(/\[[\/s\/S]+/g)&&(html=html.replace(/\[/g,"<"),html=html.replace(/\]/g,">")),$.each($(html),function(index){$(this).is("video")&&void 0!==$(this).attr("mp4")?media.push({type:"video",url:$(this).attr("mp4"),img:$(this).attr("img"),alt:"MP4 video",id:$(this).attr("id")}):$(this).find("img").length>0?media.push({type:"image",url:$(this).find("img").attr("src"),alt:$(this).find("img").attr("alt"),id:$(this).find("img").attr("class").replace(/[A-Za-z\-\s]/g,"")}):$(this).is("img")?media.push({type:"image",url:$(this).attr("src"),alt:$(this).attr("alt"),id:$(this).attr("class").replace(/[A-Za-z\-\s]/g,"")}):void 0!=$(this).attr("href")?media.push({type:"file",url:$(this).attr("href")}):$(this).is("iframe")?media.push({type:"embed",url:$(this).attr("src"),alt:$(this).attr("alt"),id:$(this).attr("class").replace(/[A-Za-z\-\s]/g,""),img:$(this).attr("img")}):$(this).hasClass("video-frame")&&media.push({type:"embed",url:$(this).find("iframe").attr("src"),alt:$(this).find("iframe").attr("alt"),id:$(this).find("iframe").attr("class").replace(/[A-Za-z\-\s]/g,""),img:$(this).find("iframe").attr("img")})}),void 0!=self.settings.filterMedia&&(media=self.settings.filterMedia(media)),self._render(media),void 0!=self.settings.success&&self.settings.success(media)},self.prev_send_to_editor=window.send_to_editor,window.send_to_editor=function(html,editor){return void 0==self.settings.editor||this.activeEditor!=self.settings.editor&&editor!=self.settings.editor?void 0==self.prev_send_to_editor?void 0:self.prev_send_to_editor(html,void 0==this.activeEditor?editor:this.activeEditor):void self._parseEditorHTML(html)},self._getTemplate(),self._add_media=function(mediaToAdd){var media=[];if(mediaToAdd.constructor!==Array){var item=mediaToAdd;mediaToAdd=[],mediaToAdd.push(item)}for(var i in mediaToAdd){var item={};(void 0!==mediaToAdd[i].type||void 0!==mediaToAdd[i].url)&&(item.type=mediaToAdd[i].type,item.url=mediaToAdd[i].url,void 0!==mediaToAdd[i].alt&&(item.alt=mediaToAdd[i].alt),void 0!==mediaToAdd[i].id&&(item.id=mediaToAdd[i].id),media.push(item))}self._render(media),void 0!=self.settings.success&&self.settings.success(media)},this.add=self._add_media,this}}(jQuery);